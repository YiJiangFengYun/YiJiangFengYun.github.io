<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0-rc1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="YiJiangFengYun">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">YiJiangFengYun</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/08/mongodb-log_all_operations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/08/mongodb-log_all_operations/" class="post-title-link" itemprop="url">MongoDB logging all operations</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-08 09:00:00" itemprop="dateCreated datePublished" datetime="2023-04-08T09:00:00+00:00">2023-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MongoDB/" itemprop="url" rel="index"><span itemprop="name">MongoDB</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="You-can-log-all-operations"><a href="#You-can-log-all-operations" class="headerlink" title="You can log all operations"></a>You can log all operations</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">MongoDB shell version: 2.4.9</span><br><span class="line">connecting to: <span class="built_in">test</span></span><br><span class="line">&gt; use myDb</span><br><span class="line">switched to db myDb</span><br><span class="line">&gt; db.getProfilingLevel()</span><br><span class="line">0</span><br><span class="line">&gt; db.setProfilingLevel(2)</span><br><span class="line">&#123; <span class="string">&quot;was&quot;</span> : 0, <span class="string">&quot;slowms&quot;</span> : 1, <span class="string">&quot;ok&quot;</span> : 1 &#125;</span><br><span class="line">&gt; db.getProfilingLevel()</span><br><span class="line">2</span><br><span class="line">&gt; db.system.profile.find( &#123; millis : &#123; <span class="variable">$gte</span>: 1 &#125;, appName : &#123; <span class="variable">$exists</span> : <span class="literal">false</span> &#125;, ns : &#123; <span class="variable">$not</span> : /system.profile/ &#125; &#125; ).<span class="built_in">sort</span>( &#123; ts : -1 &#125; )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://docs.mongodb.org/manual/reference/method/db.setProfilingLevel/">Source: http://docs.mongodb.org/manual/reference/method/db.setProfilingLevel/</a><br>db.setProfilingLevel(2) means “log all operations”.</p>
<h2 id="How-to-drop-the-collection-system-profile"><a href="#How-to-drop-the-collection-system-profile" class="headerlink" title="How to drop the collection system.profile"></a>How to drop the collection system.profile</h2><ul>
<li>Firstly, turn off the profiling by setting its level to 0.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.setProfilingLevel(0)</span><br></pre></td></tr></table></figure>

<ul>
<li>Then you can simply drop the collection.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.system.profile.drop()</span><br></pre></td></tr></table></figure>

<ul>
<li>Now you are free to go and start it all over.</li>
</ul>
<h2 id="How-to-list-operations-meets-the-criteria"><a href="#How-to-list-operations-meets-the-criteria" class="headerlink" title="How to list operations meets the criteria"></a>How to list operations meets the criteria</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询指令记录。</span></span><br><span class="line"><span class="comment">//过滤条件：1.需耗时（millis字段)多少毫秒以上，2.appName字段不存在（可能指令来自某APP，如Studio 3T), 3.ns字符串中不包含system.profile（排除指令是system.profile相关的）。</span></span><br><span class="line"><span class="comment">//排序：按时间排序。</span></span><br><span class="line">db.<span class="property">system</span>.<span class="property">profile</span>.<span class="title function_">find</span>( &#123; millis : &#123; <span class="attr">$gte</span>: <span class="number">1</span> &#125;, appName : &#123; $exists : <span class="literal">false</span> &#125;, ns : &#123; $not : <span class="regexp">/system.profile/</span> &#125; &#125; ).<span class="title function_">sort</span>( &#123; ts : -<span class="number">1</span> &#125; )</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/20/game-server-architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/20/game-server-architecture/" class="post-title-link" itemprop="url">Game Server Architecture</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-20 11:00:00" itemprop="dateCreated datePublished" datetime="2022-08-20T11:00:00+00:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Game-Development/" itemprop="url" rel="index"><span itemprop="name">Game Development</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/images/game-server-architexture(multi_maps).png" alt="Game Server Architecture"></p>
<h2 id="为什么不把游戏数据库代理服并入到网关服呢？不并入好处有以下几点"><a href="#为什么不把游戏数据库代理服并入到网关服呢？不并入好处有以下几点" class="headerlink" title="为什么不把游戏数据库代理服并入到网关服呢？不并入好处有以下几点"></a>为什么不把游戏数据库代理服并入到网关服呢？不并入好处有以下几点</h2><ol>
<li>功能与名字对应，不易混淆。</li>
<li>避免架构节点的环形依赖，更优雅。</li>
<li>负载均衡方面更加灵活，根据带宽和计算资源情况在机器上调配部署上更灵活。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/06/ss-invalid-pppoe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/06/ss-invalid-pppoe/" class="post-title-link" itemprop="url">宽带拨号后Shadowsocks代理无效.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-06 12:00:00" itemprop="dateCreated datePublished" datetime="2022-03-06T12:00:00+00:00">2022-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Shadowsocks/" itemprop="url" rel="index"><span itemprop="name">Shadowsocks</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>宽带拨号连接后，发现Shadowsocks代理无效，不能翻墙。原来是因为宽带适配器名字是中文的（宽带连接），解决办法是用英文重命名适配器，不要使用复杂字符，比如中文。</p>
<p><img src="/images/pppoe-name-fix.png" alt="Picture"><br><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/shadowsocks-windows/issues/1502">Github Issue</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/06/javascript-implicit_conversion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/06/javascript-implicit_conversion/" class="post-title-link" itemprop="url">Javascript隐式转换</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-06 11:45:00" itemprop="dateCreated datePublished" datetime="2022-03-06T11:45:00+00:00">2022-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Javascript/" itemprop="url" rel="index"><span itemprop="name">Javascript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p> toString() 和 valueOf()<br>    1 + ‘1’ &#x2F;&#x2F;‘11’ 整型 1 被转换成字符串 ‘1’，变成了 ‘1’ + ‘1’ &#x3D; ‘11’<br>    2 * ‘3’ &#x2F;&#x2F; 6  ：字符串 ‘3’ 被转换成整型 3 ，变成了 2 * 3 &#x3D; 6<br>    ————–javascript————————————–<br>    let o &#x3D; function () {<br>        this.toString &#x3D; () &#x3D;&gt; {<br>            return ‘my is o,’<br>        }<br>        this.valueOf &#x3D; () &#x3D;&gt; {<br>            return 99<br>        }<br>    }<br>    let n &#x3D; new o()<br>    console.log(n + ‘abc’) &#x2F;&#x2F; ‘99abc’<br>    console.log(n * 10) &#x2F;&#x2F; 990<br>    o + ‘1’ &#x2F;&#x2F;“function o() {\n    this.toString &#x3D; () &#x3D;&gt; {\n        return ‘my is o,’\n    }\n    \n    this.valueOf &#x3D; () &#x3D;&gt; {\n        return 99\n    }\n}”<br>    ————————————————————-<br>    加法计算，如果项A不是原始类型，如果valueOf方法存在，则会调用valueOf方法得到B，如果得到的结果B不是原始类型或者valueOf方法不存在，则如果A的<br>    toString方法存在，则调用toString方法，最后如果这个项还不是原始类型，则报错Uncaught TypeError: Cannot convert object to primitive value。<br>    乘法也是一样的<br>    ————–javascript—————————————<br>    let O &#x3D; function () {<br>        this.toString &#x3D; () &#x3D;&gt; {<br>            console.log(‘into toString’)<br>            return { ‘string’: ‘ssss’ }<br>        }<br>        this.valueOf &#x3D; () &#x3D;&gt; {<br>            console.log(‘into valueOf’)<br>            return { ‘val’: 99 }<br>        }<br>    }<br>    let o &#x3D; new O()<br>    console.log(O + ‘xx’)<br>    &#x2F;&#x2F;into valueOf<br>    &#x2F;&#x2F;into toString<br>    &#x2F;&#x2F; VM1904:12 Uncaught TypeError: Cannot convert object to primitive value<br>    —————————————————————</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/22/graphics-sight_and_light/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/graphics-sight_and_light/" class="post-title-link" itemprop="url">Sight And Light.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-22 10:00:00" itemprop="dateCreated datePublished" datetime="2021-12-22T10:00:00+00:00">2021-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Graphics/" itemprop="url" rel="index"><span itemprop="name">Graphics</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a href="/pages/sight-and-light">Sight And Light (How to create 2D visibility&#x2F;shadow effects for your game)</a></p>
<p>This post is from <a target="_blank" rel="noopener" href="https://ncase.me/sight-and-light/">https://ncase.me/sight-and-light/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/cocos_creator-socket.io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/02/cocos_creator-socket.io/" class="post-title-link" itemprop="url">Use Cocos Creator with Socket.IO</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-02 10:30:00" itemprop="dateCreated datePublished" datetime="2021-09-02T10:30:00+00:00">2021-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-09-03 10:10:00" itemprop="dateModified" datetime="2021-09-03T10:10:00+00:00">2021-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cocos-Creator/" itemprop="url" rel="index"><span itemprop="name">Cocos Creator</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>When use Cocos Creator with Socket.IO on Android platform, It may need to pass the path of a CA file to WebSocket constructor to create a new WebSocket instance. How to do this? We can use Class Extends and put operation of passing the path of the CA file to the constructor of sub class of WebSocket as follow:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWebSocket</span> <span class="keyword">extends</span> <span class="title class_ inherited__">WebSocket</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">url, protocols</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This is MyWebSocket.&quot;</span>);</span><br><span class="line">        <span class="variable language_">super</span>(url, protocols, pathCAFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">WebSocket</span> = <span class="title class_">MyWebSocket</span>;</span><br></pre></td></tr></table></figure>

<p>Now, Inner Socket.IO will use the class MyWebSocket to create a WebSocket instance.</p>
<p>This code snippet should execute before importing Socket.IO module (For example, put the code snippet to main.js created after build the project for Android platform).</p>
<p>For example, if a CA file is resources&#x2F;ssl&#x2F;cacert.pem, main.js should be as follow:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyWebSocket</span> <span class="keyword">extends</span> <span class="title class_ inherited__">WebSocket</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">url, protocols</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(url, protocols, cc.<span class="property">url</span>.<span class="title function_">raw</span>(<span class="string">&quot;resources/ssl/cacert.pem&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">WebSocket</span> = <span class="title class_">MyWebSocket</span>;</span><br><span class="line"><span class="comment">/// other code </span></span><br><span class="line"><span class="comment">///...</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/16/network-socket-heartbeat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/16/network-socket-heartbeat/" class="post-title-link" itemprop="url">Why Do Socket Need Heartbeat.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-08-16 19:30:00 / Modified: 19:46:00" itemprop="dateCreated datePublished" datetime="2021-08-16T19:30:00+00:00">2021-08-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network/Socket/" itemprop="url" rel="index"><span itemprop="name">Socket</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Why-do-socket-need-heartbeat"><a href="#Why-do-socket-need-heartbeat" class="headerlink" title="Why do socket need heartbeat"></a>Why do socket need heartbeat</h2><p>Sometimes the link between the server and the client can be interrupted in a way that keeps both the server and the client unaware of the broken state of the connection</p>
<p>For example, If a socket client connnect to a socket server through a router, then the router network is interrupted. in this case the socket client and the socket server is unaware of the broken state of the connection. Two side sockets can send packets but the packets sended will never reach each other.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/02/nginx-socketio-400-error/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/02/nginx-socketio-400-error/" class="post-title-link" itemprop="url">Nginx Proxy Socket.io 400 Bad Request</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-08-02 16:00:00" itemprop="dateCreated datePublished" datetime="2021-08-02T16:00:00+00:00">2021-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>nginx代理了两台socket.io服务器。socket.io的工作模式是polling升级到websocket</p>
<h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p>通过nginx请求服务时，出现了大量的400错误，有时候能升级到websocket，有时候会一直报错。但是直接通过ip+端口访问时，100%能成功。</p>
<p><img src="/images/socket.io_400.jpg" alt="Image"></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>sid是我们这个问题的关键。在初始创建连接时（polling模式就是在模拟一个长连接），客户端会发起这样的请求：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://***/?EIO=3&amp;transport=polling&amp;t=1540820717277-0</span><br></pre></td></tr></table></figure>

<p>服务端收到后会创建一个对象，绑定在这个连接上，同时返回一个sid（session id），来标记这个会话。会话指什么呢，会话是一连串的交互，这些交互之间是有联系的，在我们这个场景下就是，下一次的http请求到来，我需要找到之前绑定在理论上的长连接（这里还没有websocket，所以是理论上的）上的那个对象。我们知道http请求是无状态的，每个请求之间独立，所以socket.io引入了sid来做这件事。服务端收到请求后会生成一个sid，看下response：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;sid&quot;:&quot;EoGaL3fRQlpTOaLp5eST&quot;,&quot;upgrades&quot;:[&quot;websocket&quot;],&quot;pingInterval&quot;:8000,&quot;pingTimeout&quot;:10000&#125;</span><br></pre></td></tr></table></figure>

<p>之后每次请求都需要带上这个sid，建立websocket请求的连接也不例外。所以说，sid是polling，以及polling升级到websocket的关键。这之后的请求类似于：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://***/?EIO=3&amp;transport=polling&amp;t=1540820717314-1&amp;sid=EoGaL3fRQlpTOaLp5eST</span><br><span class="line">or</span><br><span class="line">wss://***/?EIO=3&amp;transport=websocket&amp;t=1540820717314-1&amp;sid=EoGaL3fRQlpTOaLp5eST</span><br></pre></td></tr></table></figure>

<p>那么问题来了，如果请求是带上的sid不是服务端生成的会怎样呢？服务端会不认识，给你返回一个400，并告诉你</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invalid sid</span><br></pre></td></tr></table></figure>

<p>我们遇到的便是这个问题，nginx默认的负载均衡策略是轮询，所以请求有可能会打到不是生成这个sid的机器上去，这时候我们就会收到一个400，如果运气好，可能也会打到原来的机器上，运气更好一点，甚至能坚持到websocket连接建立。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>这里提出两种方案</p>
<ol>
<li>nginx的负载均衡采用ip_hash，这样能保证一个客户端的请求都走到一台服务器上</li>
<li>不使用polling模式，只使用websocket</li>
</ol>
<p>这两种方案各有利弊。第二种显而易见，不支持websocket的古老浏览器和客户端将没法工作。第一种的问题隐藏得比较深，试想，如果你增减了机器会怎样，这时候ip_hash策略的模将变化，之前的连接将全部失效，而对于微服务，扩缩容是很频繁的操作（特别是产品处于发展期），这种有损的扩缩容很大概率是不能接受的。</p>
<p>综上，建议直接使用websocket，毕竟不支持websocket的老版本占比很少，而且相对于先polling，耗时也会减少。</p>
<p> This post is from <a target="_blank" rel="noopener" href="http://michaelyou.github.io/2018/10/29/nginx%E4%BB%A3%E7%90%86socket-io%E6%9C%8D%E5%8A%A1%E8%B8%A9%E5%9D%91/">nginx代理socket.io服务踩坑</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/02/cocos_creator-ios_brower_force_sound/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/02/02/cocos_creator-ios_brower_force_sound/" class="post-title-link" itemprop="url">Game play sound in IOS brower when Iphone turn on mute.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-02-02 11:21:00 / Modified: 11:27:00" itemprop="dateCreated datePublished" datetime="2021-02-02T11:21:00+00:00">2021-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Cocos-Creator/" itemprop="url" rel="index"><span itemprop="name">Cocos Creator</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>When Iphone turn on mute setting. game is mute.<br>We can keep game unmute by playing first sound loaded using audio DOM element when click first button.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Factory function</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createFirstDomAudio</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> enable = <span class="literal">true</span>;</span><br><span class="line">    enable = enable &amp;&amp; cc.<span class="property">sys</span>.<span class="property">os</span> === cc.<span class="property">sys</span>.<span class="property">OS_IOS</span> &amp;&amp; cc.<span class="property">sys</span>.<span class="property">isBrowser</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="attr">audioFirst</span>: <span class="title class_">HTMLAudioElement</span>;</span><br><span class="line">    <span class="keyword">if</span> (enable) &#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">&quot;...&quot;</span>;</span><br><span class="line">        audioFirst = <span class="keyword">new</span> <span class="title class_">Audio</span>(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        enable,</span><br><span class="line">        audioFirst,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Instance object.</span></span><br><span class="line"><span class="keyword">const</span> firstDomAudio = <span class="title function_">createFirstDomAudio</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Click event handler for first button.</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ! firstDomAudio.<span class="property">enable</span>) <span class="keyword">return</span>;</span><br><span class="line">    firstDomAudio.<span class="property">audioFirst</span>.<span class="title function_">play</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/28/game_development-example_user_items/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YiJiangFengYun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/28/game_development-example_user_items/" class="post-title-link" itemprop="url">Example for items of a game user.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-01-28 09:00:00" itemprop="dateCreated datePublished" datetime="2021-01-28T09:00:00+00:00">2021-01-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-01-30 10:37:00" itemprop="dateModified" datetime="2021-01-30T10:37:00+00:00">2021-01-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Game-Development/" itemprop="url" rel="index"><span itemprop="name">Game Development</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h2><p>First, the game should has some basic types. I use typescript language to describe these types.<br>The game has a root item types: money, cloth and clothes. Money is used to buy cloth and clothes.<br>Cloth is material of clothes. Clothes has durability and is worn by the user.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ItemType is a top type of item.</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ItemType</span> &#123;</span><br><span class="line">    <span class="variable constant_">UNDEFINED</span>,</span><br><span class="line">    <span class="variable constant_">MONEY</span>,</span><br><span class="line">    <span class="variable constant_">CLOTH</span>,</span><br><span class="line">    <span class="variable constant_">CLOTHES</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Item is a base type of item</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>, <span class="comment">//The property id of item should be unique to every item instances.</span></span><br><span class="line">    <span class="attr">typeId</span>: <span class="built_in">string</span>, <span class="comment">//The property typeId of item is string composed of all levels of the hierarchy of item type.</span></span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">ItemType</span>, <span class="comment">// The property type of item indicate a item is money, cloth or clothes.</span></span><br><span class="line">    <span class="attr">num</span>: <span class="built_in">number</span>, <span class="comment">// The property num of item is a quantity of item.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//User is the type of user</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">string</span>, <span class="comment">// A user owns a unique id too.</span></span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>, <span class="comment">// A user has a name.</span></span><br><span class="line">    <span class="attr">items</span>: <span class="title class_">Item</span>[], <span class="comment">// This is a array of items user owns.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//This constant is a user object</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line">    <span class="attr">id</span>: ...,</span><br><span class="line">    <span class="attr">name</span>: ...,</span><br><span class="line">    <span class="attr">items</span>: [],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Money"><a href="#Money" class="headerlink" title="Money"></a>Money</h2><p>Money is a single instance, so it can be created directly in code.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line"></span><br><span class="line">    ... </span><br><span class="line"></span><br><span class="line">    <span class="attr">items</span>: [ </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">id</span>: ...,</span><br><span class="line">            <span class="attr">typeId</span>: <span class="string">&quot;1&quot;</span>, <span class="comment">//Money has only one level type of 1.</span></span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Item</span>.<span class="property">MONEY</span>,</span><br><span class="line">            <span class="attr">num</span>: ...,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Cloth"><a href="#Cloth" class="headerlink" title="Cloth"></a>Cloth</h2><p>There are many kind of cloth. Same kind of cloth has same properties and its value, so they can put into a single object.  </p>
<p>Config:</p>
<table>
<thead>
<tr>
<th>type_id:string (auto generated)</th>
<th>item_type:int32</th>
<th>cloth_type:int32</th>
<th>name:string</th>
</tr>
</thead>
<tbody><tr>
<td>2-1</td>
<td>2</td>
<td>1</td>
<td>White Cloth</td>
</tr>
<tr>
<td>2-2</td>
<td>2</td>
<td>2</td>
<td>Black Cloth</td>
</tr>
<tr>
<td>2-3</td>
<td>2</td>
<td>3</td>
<td>Red Cloth</td>
</tr>
</tbody></table>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ClothType</span> &#123;</span><br><span class="line">    <span class="variable constant_">UNDEFINED</span>,</span><br><span class="line">    <span class="variable constant_">WHITE</span>,</span><br><span class="line">    <span class="variable constant_">BLACK</span>,</span><br><span class="line">    <span class="variable constant_">RED</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ClothItem</span> <span class="keyword">extends</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">    <span class="attr">clothType</span>: <span class="title class_">ClothType</span>, </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line"></span><br><span class="line">    ... </span><br><span class="line"></span><br><span class="line">    <span class="attr">items</span>: [</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">id</span>: ...,</span><br><span class="line">            <span class="attr">typeId</span>: <span class="string">&quot;2-1&quot;</span>, <span class="comment">//Cloth has two level of types, they connect with &quot;ItemType-ClothType&quot;.</span></span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">ItemType</span>.<span class="property">Cloth</span>,</span><br><span class="line">            <span class="attr">clothType</span>: <span class="title class_">ClothType</span>.<span class="property">WHITE</span>,</span><br><span class="line">            <span class="attr">num</span>: ...,</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">id</span>: ...,</span><br><span class="line">            <span class="attr">typeId</span>: <span class="string">&quot;2-2&quot;</span>, <span class="comment">//Cloth has two level of types, they connect with &quot;ItemType-ClothType&quot;.</span></span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">ItemType</span>.<span class="property">Cloth</span>,</span><br><span class="line">            <span class="attr">clothType</span>: <span class="title class_">ClothType</span>.<span class="property">BLACK</span>,</span><br><span class="line">            <span class="attr">num</span>: ...,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Clothes"><a href="#Clothes" class="headerlink" title="Clothes"></a>Clothes</h2><p>There are many kind of clothes. Same properties of same kind of clothes can own different value, so every instance of clothes should be a object alone.  </p>
<p>Config:</p>
<table>
<thead>
<tr>
<th>type_id:string (auto generated)</th>
<th>item_type:int32</th>
<th>clothes_type:int32</th>
<th>name:string</th>
<th>durability:int32 (unit: day)</th>
</tr>
</thead>
<tbody><tr>
<td>3-1</td>
<td>3</td>
<td>1</td>
<td>Pure White</td>
<td>2</td>
</tr>
<tr>
<td>3-2</td>
<td>3</td>
<td>2</td>
<td>Pinto</td>
<td>3</td>
</tr>
</tbody></table>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ClothesType</span> &#123;</span><br><span class="line">    <span class="variable constant_">UNDEFINED</span>,</span><br><span class="line">    <span class="variable constant_">PURE_WHITE</span>,</span><br><span class="line">    <span class="variable constant_">PINTO</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ClothesItem</span> <span class="keyword">extends</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">    <span class="attr">clothesType</span>: <span class="title class_">ClothesType</span>,</span><br><span class="line">    <span class="attr">remainDay</span>: <span class="built_in">number</span>, <span class="comment">//Remain time (uint: day)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: <span class="title class_">User</span> = &#123;</span><br><span class="line"></span><br><span class="line">    ... </span><br><span class="line"></span><br><span class="line">    <span class="attr">items</span>: [</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">id</span>: ...,</span><br><span class="line">            <span class="attr">typeId</span>: <span class="string">&quot;3-1&quot;</span>, <span class="comment">//Clothes has two level of types, they connect with &quot;ItemType-ClothesType&quot;.</span></span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">ItemType</span>.<span class="property">Clothes</span>,</span><br><span class="line">            <span class="attr">clothesType</span>: <span class="title class_">ClothesType</span>.<span class="property">PURE_WHITE</span>,</span><br><span class="line">            <span class="attr">num</span>: <span class="number">1</span>, <span class="comment">//Clothes num is always one.</span></span><br><span class="line">            <span class="attr">remainDay</span>: ..., <span class="comment">//Different clothes has different ramain day</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">id</span>: ...,</span><br><span class="line">            <span class="attr">typeId</span>: <span class="string">&quot;3-2&quot;</span>, <span class="comment">//Clothes has two level of types, they connect with &quot;ItemType-ClothesType&quot;.</span></span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">ItemType</span>.<span class="property">Clothes</span>,</span><br><span class="line">            <span class="attr">clothesType</span>: <span class="title class_">ClothesType</span>.<span class="property">PINTO</span>,</span><br><span class="line">            <span class="attr">num</span>: <span class="number">1</span>, <span class="comment">//Clothes num is always one.</span></span><br><span class="line">            <span class="attr">remainDay</span>: ..., <span class="comment">//Different clothes has different ramain day</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h2><p>If manager want to award items to a user, he can always fill a object data with special values of typeId and num properties.<br>For example, awarding a user 2 black cloth can be done through filling data object { typeId: “2-2”, num: 2 }, rather than data object { type: 2, clothType: 2, num: 2 }.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YiJiangFengYun</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
